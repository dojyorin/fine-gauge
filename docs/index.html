<!doctype html>
<meta charset="utf-8">

<meta name="referrer" content="no-referrer">
<meta name="viewport" content="height=device-height, width=device-width, minimum-scale=1, maximum-scale=1, initial-scale=1, user-scalable=no">

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50%' y='50%' style='dominant-baseline: central; text-anchor: middle; font-size: 100px;'>üö•</text></svg>">

<script async type="module">
    import {createApp, defineComponent, ref, provide, inject} from "https://esm.sh/vue@3/dist/vue.esm-bundler.js?target=esnext";
    import {createRouter, createWebHashHistory} from "https://esm.sh/vue-router@4?target=esnext";
    import {createVuetify, useTheme} from "https://esm.sh/vuetify@3/dist/vuetify.esm.js?target=esnext";

    /**
     * @typedef {{mount(target: Element): void; use(plugin: Plugin): void;}} Vue
     */

    /**
     * @typedef {{install(context: Vue): void;}} Plugin
     */

    /**
     * @typedef {{template: string; setup?(): Record<string, unknown> | void; components?: Record<string, Component>;}} Component
     */

    /**
     * @template T
     * @typedef {{value: T;}} Ref
     */

    /**
     * @typedef {Plugin & {push(path: string): void; beforeEach(func: (to: Route, from: Route, next: () => void) => Promise<void | boolean | string>): void;}} Router
     */

    /**
     * @typedef {{path: string; hash: string; query: Record<string, string>; params: Record<string, string>; name?: string; meta?: Record<string, unknown>;}} Route
     */

    /**
     * @typedef {Plugin & {theme: Theme;}} Vuetify
     */

    /**
     * @typedef {{global: {name: Ref<string>;};}} Theme
     */

    /** @type {(component: Component) => Vue} */
    const _createApp = createApp;
    /** @type {(component: Component) => Component} */
    const _defineComponent = defineComponent;
    /** @type {<T>(value: T) => Ref<T>} */
    const _ref = ref;
    /** @type {<T>(key: string, value: T) => void} */
    const _provide = provide;
    /** @type {<T>(key: string) => T} */
    const _inject = inject;
    /** @type {(option: {history: Record<string, unknown>; routes: {path: string; name?: string; component?: Component;}[];}) => Router} */
    const _createRouter = createRouter;
    /** @type {() => Record<string, unknown>} */
    const _createWebHashHistory = createWebHashHistory;
    /** @type {(option?: {theme?: {defaultTheme?: string;}; defaults?: Record<string, Record<string, unknown>>; components?: Record<string, unknown>; aliases?: Record<string, unknown>; directives?: Record<string, unknown>;}) => Vuetify} */
    const _createVuetify = createVuetify;
    /** @type {() => Theme} */
    const _useTheme = useTheme;

    import {Chart} from "https://esm.sh/chart.js@4.5.1/auto?target=esnext";

    /**
     * @typedef {{type: string; data: {datasets: {data: unknown[]; label?: string; backgroundColor?: string;}[]; labels?: string[];}; options?: {plugins?: {title?: {display?: boolean; text?: string;}; tooltip?: {callbacks?: {afterLabel?(): string | string[] | void;};};};} & BarOption;}} Option
     */

    /**
     * @typedef {{scales?: {y?: {ticks?: {stepSize?: number; precision?: number;};};};}} BarOption
     */

    /** @type {new (target: HTMLCanvasElement | OffscreenCanvas, option: Option) => {clear(): void; update(): void;} & Omit<Option, "type">} */
    const _Chart = Chart;

    import {default as confetti} from "https://esm.sh/canvas-confetti@1.9.4?target=esnext";

    /** @type {(option?: {angle?: number; origin?: {x?: number; y?: number;};}) => Promise<void>} */
    const _confetti = confetti;

    import {z} from "https://esm.sh/zod@4.1.12?target=esnext";

    /** @type {unknown} */
    const _z = z;

    /**
     * @template {Record<string, unknown> | unknown[]} T
     * @param {"local" | "session"} type
     * @param {string} key
     * @param {T} value
     * @return {T}
     */
    function createStorage(type, key, value) {
        /**
         * @template {unknown} U
         * @param {U} data
         * @return {U}
         */
        function createProxy(data) {
            if (typeof data !== "object" || data === null) {
                return data;
            }

            return new Proxy(data, {
                get(t, p) {
                    const a = Reflect.get(t, p);

                    return createProxy(a);
                },
                set(t, p, v) {
                    const a = Reflect.set(t, p, v);

                    if (a) {
                        setValue(body);
                    }

                    return a;
                },
                deleteProperty(t, p) {
                    const a = Reflect.deleteProperty(t, p);

                    if (a) {
                        setValue(body);
                    }

                    return a;
                }
            });
        }

        /**
         * @return {T | null}
         */
        function getValue() {
            return JSON.parse(storage.getItem(key) ?? "null");
        }

        /**
         * @param {T | null} data
         * @return {void}
         */
        function setValue(data) {
            storage.setItem(key, JSON.stringify(data));
        }

        const storage = type === "local" ? localStorage : sessionStorage;

        const maybeBody = getValue();
        const body = structuredClone(maybeBody ?? value);

        if (!maybeBody) {
            setValue(body);
        }

        return createProxy(body);
    }

    /**
     * @template {boolean} T
     * @param {T} multiple
     * @param {string} [accept]
     * @return {Promise<T extends true ? File[] : File>}
     */
    async function upload(multiple, accept) {
        return await new Promise((res, rej) => {
            const input = document.createElement("input");
            input.type = "file";
            input.multiple = multiple;
            input.accept = accept ?? "";
            input.onchange = (event) => input.files?.length ? res(multiple ? Array.from(input.files) : input.files.item(0)) : rej(event);
            input.oncancel = (event) => rej(event);
            input.click();
        });
    }

    /**
     * @param {string} name
     * @param {BlobPart} data
     * @return {void}
     */
    function download(name, data) {
        const a = document.createElement("a");
        a.download = name;
        a.href = URL.createObjectURL(new Blob([data]));
        a.click();
    }

    /** @type {string[]} */
    const store_actions = createStorage("session", "action", []);
    /** @type {{date: string; actions: string[]; memo: string;}[]} */
    const store_reports = createStorage("session", "report", []);

    function vueUseReport() {
        const actions = _ref(store_actions);
        const reports = _ref(store_reports);

        const today = new Date().toLocaleDateString("sv-se");

        if (!reports.value.some(({date}) => date === today)) {
            reports.value.push({
                date: today,
                actions: [],
                memo: ""
            });
        }

        const maybeReport = reports.value.find(({date}) => date === today);

        if (!maybeReport) {
            throw new ReferenceError();
        }

        const todayReport = _ref(maybeReport);

        for (const action of todayReport.value.actions) {
            if (!actions.value.includes(action)) {
                actions.value.push(action);
            }
        }

        return {actions, reports, todayReport};
    }

    function vueUseDialog() {
        /** @type {Ref<{color: string; text: string;}[]>} */
        const toasts = _inject("toasts");
        /** @type {Ref<boolean>} */
        const loading = _inject("loading");

        /**
         * @param {string} color
         * @param {string} text
         * @return {void}
         */
        function pushToast(color, text) {
            toasts.value.push({color, text});
        }

        /**
         * @param {boolean} [state]
         * @return {void}
         */
        function toggleLoading(state) {
            loading.value = state ?? !loading.value;
        }

        return {toasts, loading, pushToast, toggleLoading};
    }

    const vueApplication = _defineComponent({
        template: /*html*/`
            <v-app>
                <x-toast></x-toast>
                <x-loading></x-loading>
                <x-header></x-header>
                <v-main>
                    <router-view></router-view>
                </v-main>
            </v-app>
        `,
        components: {
            "x-toast": _defineComponent({
                template: /*html*/`
                    <v-snackbar-queue closable location="top right" timeout="5000" v-model="toasts">
                        <template #actions="{props}">
                            <v-btn :="props" density="compact" icon="mdi-close"></v-btn>
                        </template>
                    </v-snackbar-queue>
                `,
                setup() {
                    const {toasts} = vueUseDialog();

                    return {toasts};
                }
            }),
            "x-loading": _defineComponent({
                template: /*html*/`
                    <v-overlay persistent no-click-animation class="justify-center align-center" v-model="loading">
                        <v-progress-circular indeterminate size="60" width="4" color="primary"></v-progress-circular>
                    </v-overlay>
                `,
                setup() {
                    const {loading} = vueUseDialog();

                    return {loading};
                }
            }),
            "x-header": _defineComponent({
                template: /*html*/`
                    <v-app-bar theme="dark" density="compact">
                        <template #prepend>
                            <v-app-bar-nav-icon @click="nav = !nav;"></v-app-bar-nav-icon>
                        </template>

                        <template #append>
                            <v-btn icon="mdi-theme-light-dark" @click="toggleDark();"></v-btn>
                        </template>

                        <template #image>
                            <v-img gradient="45deg, #10B5B2, #22E6B5"></v-img>
                        </template>

                        <v-app-bar-title>
                            <router-link class="text-decoration-none text-high-emphasis" to="/">ÂÖÉÊ∞ó„Ç≤„Éº„Ç∏</router-link>
                        </v-app-bar-title>
                    </v-app-bar>

                    <v-navigation-drawer floating temporary v-model="nav">
                        <v-list nav density="compact">
                            <v-list-item to="/">
                                <v-list-item-title>„Éõ„Éº„É†</v-list-item-title>
                            </v-list-item>

                            <v-list-item to="/diary">
                                <v-list-item-title>Êó•Ë®ò</v-list-item-title>
                            </v-list-item>

                            <v-list-item to="/statistics">
                                <v-list-item-title>Áµ±Ë®à</v-list-item-title>
                            </v-list-item>

                            <v-list-item to="/configure">
                                <v-list-item-title>Ë®≠ÂÆö</v-list-item-title>
                            </v-list-item>

                            <v-list-item to="/about">
                                <v-list-item-title>„Åì„ÅÆ„Ç¢„Éó„É™„Å´„Å§„ÅÑ„Å¶</v-list-item-title>
                            </v-list-item>
                        </v-list>
                    </v-navigation-drawer>
                `,
                setup() {
                    const theme = _useTheme();

                    const nav = _ref(false);

                    function toggleDark() {
                        theme.global.name.value = theme.global.name.value === "dark" ? "light" : "dark";
                    }

                    return {nav, toggleDark};
                }
            })
        },
        setup() {
            _provide("toasts", _ref([]));
            _provide("loading", _ref(false));
        }
    });

    const vueRouter = _createRouter({
        history: _createWebHashHistory(),
        routes: [{
            path: "/",
            component: _defineComponent({
                template: /*html*/`
                    <v-container>
                        <v-row>
                            <v-col cols sm="4" md="3">
                                <v-card height="100" color="cyan-darken-1" to="/diary">
                                    <v-card-item>
                                        <v-card-title>Êó•Ë®ò</v-card-title>
                                        <v-card-subtitle>‰ªäÊó•„ÅÆÂá∫Êù•‰∫ã„ÇíË®òÈå≤„Åô„Çã</v-card-subtitle>
                                    </v-card-item>
                                </v-card>
                            </v-col>

                            <v-col cols sm="4" md="3">
                                <v-card height="100" color="green-darken-1" to="/statistics">
                                    <v-card-item>
                                        <v-card-title>Áµ±Ë®à</v-card-title>
                                        <v-card-subtitle>ÈÅéÂéª„ÅÆË®òÈå≤„ÇíÂàÜÊûê„Åô„Çã</v-card-subtitle>
                                    </v-card-item>
                                </v-card>
                            </v-col>

                            <v-col cols sm="4" md="3">
                                <v-card height="100" color="purple-lighten-1" to="/configure">
                                    <v-card-item>
                                        <v-card-title>Ë®≠ÂÆö</v-card-title>
                                        <v-card-subtitle>„Ç∑„Çπ„ÉÜ„É†„ÅÆÊåôÂãï„ÇíË™øÊï¥„Åô„Çã</v-card-subtitle>
                                    </v-card-item>
                                </v-card>
                            </v-col>

                            <v-col cols sm="4" md="3">
                                <v-card height="100" color="pink-lighten-1" to="/about">
                                    <v-card-item>
                                        <v-card-title>„Åì„ÅÆ„Ç¢„Éó„É™„Å´„Å§„ÅÑ„Å¶</v-card-title>
                                        <v-card-subtitle>Ê¶ÇË¶Å„ÇÑ„Éò„É´„Éó„Å™„Å©</v-card-subtitle>
                                    </v-card-item>
                                </v-card>
                            </v-col>
                        </v-row>
                    </v-container>
                `
            })
        }, {
            path: "/diary",
            component: _defineComponent({
                template: /*html*/`
                    <v-container max-width="600">
                        <v-card flat color="transparent">
                            <v-card-item>
                                <v-card-title class="text-h4">{{todayReport.date.replaceAll("-", "/")}} „ÅÆÊó•Ë®ò</v-card-title>
                                <v-card-subtitle>„Åß„Åç„Åü„Åì„Å®„ÇíË®òÈå≤„Åó„Çà„ÅÜÔºÅ</v-card-subtitle>
                            </v-card-item>
                        </v-card>

                        <v-row>
                            <v-col cols="12">
                                <v-card>
                                    <v-card-text>
                                        <v-list v-if="actions.length" selectable select-strategy="independent" v-model:selected="todayReport.actions">
                                            <template v-for="(action, i) in actions">
                                                <v-divider v-if="i"></v-divider>

                                                <v-list-item :value="action">
                                                    <v-list-title v-if="!actions_edit[i]">{{action}}</v-list-title>
                                                    <v-text-field v-else single-line hide-details clearable v-model="action" @keyup.enter="actions_edit[i] = false;"></v-text-field>

                                                    <template #prepend="{isSelected, select}">
                                                        <v-checkbox v-if="!actions_edit[i]" hide-details :model-value="isSelected" @update:model-value="select"></v-checkbox>
                                                    </template>

                                                    <template #append="{isSelected}">
                                                        <template v-if="actions_edit[i]">
                                                            <div class="d-flex flex-column">
                                                                <v-btn flat density="comfortable" icon="mdi-menu-up-outline" :style="{'visibility': i === 0 ? 'hidden' : 'revert'}" @click="actions.splice(i - 1, 2, actions[i], actions[i - 1]);"></v-btn>
                                                                <v-btn flat density="comfortable" icon="mdi-menu-down-outline" :style="{'visibility': i + 1 === actions.length ? 'hidden' : 'revert'}" @click="actions.splice(i, 2, actions[i + 1], actions[i]);"></v-btn>
                                                            </div>

                                                            <v-btn flat density="comfortable" icon="mdi-playlist-remove" @click="isSelected = false; actions.splice(i, 1);"></v-btn>
                                                            <v-btn flat density="comfortable" icon="mdi-playlist-check" :disabled="!action" @click="actions_edit[i] = false;"></v-btn>
                                                        </template>

                                                        <v-btn v-else flat density="comfortable" icon="mdi-playlist-edit" @click="isSelected = false; actions_edit[i] = true;"></v-btn>
                                                    </template>
                                                </v-list-item>
                                            </template>
                                        </v-list>

                                        <v-list v-else>
                                            <v-list-item>
                                                <v-list-item-title>(Ê¥ªÂãï„Åå„ÅÇ„Çä„Åæ„Åõ„Çì)</v-list-item-title>
                                            </v-list-item>
                                        </v-list>

                                        <v-text-field hide-details label="Ê¥ªÂãï" v-model="newAction">
                                            <template #append>
                                                <v-btn flat density="comfortable" icon="mdi-playlist-plus" :disabled="!newAction || actions.includes(newAction)" @click="actions.push(newAction); newAction = '';"></v-btn>
                                            </template>
                                        </v-text-field>
                                    </v-card-text>
                                </v-card>
                            </v-col>

                            <v-col cols="12">
                                <v-card>
                                    <v-card-text>
                                        <v-textarea no-resize hide-details label="„É°„É¢Â∏≥" v-model="todayReport.memo"></v-textarea>
                                    </v-card-text>
                                </v-card>
                            </v-col>
                        </v-row>
                    </v-container>
                `,
                setup() {
                    const {pushToast} = vueUseDialog();
                    const {actions, todayReport} = vueUseReport();

                    const actions_edit = _ref(Array.from({length: actions.value.length}, () => false));
                    const newAction = _ref("");

                    return {actions, todayReport, actions_edit, newAction};
                }
            })
        }, {
            path: "/statistics",
            component: _defineComponent({
                template: /*html*/`
                    <v-container>
                        <v-card flat color="transparent">
                            <v-card-item>
                                <v-card-title class="text-h4">Áµ±Ë®à</v-card-title>
                            </v-card-item>
                        </v-card>
                    </v-container>
                `
            })
        }, {
            path: "/configure",
            component: _defineComponent({
                template: /*html*/`
                    <v-container>
                        <v-card flat color="transparent">
                            <v-card-item>
                                <v-card-title class="text-h4">Ë®≠ÂÆö</v-card-title>
                            </v-card-item>
                        </v-card>

                        <v-row>
                            <v-col cols="12">
                                <v-card>
                                    <v-card-item>
                                        <v-card-title>„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Å®„É™„Çπ„Éà„Ç¢</v-card-title>
                                    </v-card-item>

                                    <v-card-actions>
                                        <v-dialog>
                                            <template #activator="{props}">
                                                <v-btn :="props">„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó</v-btn>
                                            </template>

                                            <template #="{isActive}">
                                                <v-card>
                                                    <v-card-item>
                                                        <v-card-title>„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó</v-card-title>
                                                    </v-card-item>

                                                    <v-card-text>
                                                        „Éá„Éº„Çø„Éô„Éº„Çπ„Åã„Çâ„Éï„Ç°„Ç§„É´„Å´„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åô„ÄÇ
                                                    </v-card-text>

                                                    <v-card-actions>
                                                        <v-btn variant="outlined" color="blue" @click="exportReport(); isActive.value = false;">ÂÆüË°å</v-btn>
                                                        <v-btn @click="isActive.value = false;">„Ç≠„É£„É≥„Çª„É´</v-btn>
                                                    </v-card-actions>
                                                </v-card>
                                            </template>
                                        </v-dialog>

                                        <v-dialog>
                                            <template #activator="{props}">
                                                <v-btn :="props">„É™„Çπ„Éà„Ç¢</v-btn>
                                            </template>

                                            <template #="{isActive}">
                                                <v-card>
                                                    <v-card-item>
                                                        <v-card-title>„É™„Çπ„Éà„Ç¢</v-card-title>
                                                    </v-card-item>

                                                    <v-card-text>
                                                        „Éï„Ç°„Ç§„É´„Åã„Çâ„Éá„Éº„Çø„Éô„Éº„Çπ„Å´„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åô„ÄÇ

                                                        <div class="text-red">[Ê≥®ÊÑè] Êó¢Â≠ò„ÅÆ„Éá„Éº„Çø„ÅØÂÖ®„Å¶ÂâäÈô§„Åï„Çå„Åæ„Åô„ÄÇ</div>
                                                    </v-card-text>

                                                    <v-card-actions>
                                                        <v-btn variant="outlined" color="red" @click="importReport(); isActive.value = false;">ÂÆüË°å</v-btn>
                                                        <v-btn @click="isActive.value = false;">„Ç≠„É£„É≥„Çª„É´</v-btn>
                                                    </v-card-actions>
                                                </v-card>
                                            </template>
                                        </v-dialog>
                                    </v-card-actions>
                                </v-card>
                            </v-col>
                        </v-row>
                    </v-container>
                `,
                setup() {
                    const {pushToast, toggleLoading} = vueUseDialog();
                    const {reports} = vueUseReport();

                    async function importReport() {
                        toggleLoading(true);

                        try {
                            const json = await upload(false, ".json");
                            /** @type {typeof reports["value"]} */
                            const json_reports = _z.object({
                                date: _z.iso.date(),
                                actions: _z.string().noempty().array(),
                                memo: _z.string()
                            }).strict().array().parse(JSON.parse(await json.text()));

                            reports.value.splice(0);

                            for (const report of json_reports) {
                                reports.value.push(report);
                            }

                            pushToast("green", "„É™„Çπ„Éà„Ç¢ÊàêÂäü");
                        } catch (error) {
                            pushToast("red", "„É™„Çπ„Éà„Ç¢Â§±Êïó");

                            throw error;
                        } finally {
                            toggleLoading(false);
                        }
                    }

                    function exportReport() {
                        download(`${new Date().toLocaleString("sv-se").replace("-", "").replace(" ", "").replace(":", "")}.json`, JSON.stringify(reports.value));
                    }

                    return {importReport, exportReport};
                }
            })
        }, {
            path: "/about",
            component: _defineComponent({
                template: /*html*/`
                    <v-container>
                        <v-card flat color="transparent">
                            <v-card-item>
                                <v-card-title class="text-h4">„Åì„ÅÆ„Ç¢„Éó„É™„Å´„Å§„ÅÑ„Å¶</v-card-title>
                            </v-card-item>
                        </v-card>
                    </v-container>
                `
            })
        }, {
            path: "/:catchAll(.*)",
            component: _defineComponent({
                template: /*html*/`
                    <v-container fluid class="justify-center fill-height">
                        <v-card flat color="transparent">
                            <v-card-item class="justify-center">
                                <v-card-title class="text-h3">ü•∫Not Foundü•∫</v-card-title>
                            </v-card-item>

                            <v-card-actions class="justify-center">
                                <v-btn to="/" class="text-h6">Back to Top</v-btn>
                            </v-card-actions>
                        </v-card>
                    </v-container>
                `
            })
        }]
    });

    const vueVuetify = _createVuetify({
        theme: {
            defaultTheme: "system"
        },
        defaults: {
            VBtn: {
                class: ["text-none"]
            },
            VTextField: {
                variant: "underlined",
                color: "blue"
            },
            VTextarea: {
                variant: "underlined",
                color: "blue"
            },
            VDialog: {
                persistent: true,
                scrollable: true,
                maxHeight: 800,
                maxWidth: 600
            }
        }
    });

    const vue = _createApp(vueApplication);
    vue.use(vueRouter);
    vue.use(vueVuetify);
    vue.mount(document.getElementById("vue"));
</script>

<style>
    @import "https://esm.sh/vuetify@3/dist/vuetify.css";
    @import "https://esm.sh/@mdi/font@7.4.47/css/materialdesignicons.css";
    @import "https://fonts.googleapis.com/css?family=M+PLUS+1+Code:wght@100;200;300;400;500;600;700";

    * {
        font-family: "M PLUS 1 Code" !important;
        scrollbar-width: none !important;
    }
</style>

<title>ÂÖÉÊ∞ó„Ç≤„Éº„Ç∏</title>

<div id="vue"></div>